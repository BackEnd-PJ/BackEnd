<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ì¹´ì¹´ì˜¤ ì§€ë„ - ì»¤ìŠ¤í…€ ê²€ìƒ‰ + ë°˜ê²½</title>
  <style>
    html, body {height:100%; margin:0; padding:0;}
    .container {display:flex; height:100%;}

    /* ì™¼ìª½ ì‚¬ì´ë“œë°” */
    .sidebar {
      width:350px;
      background:#fff;
      border-right:1px solid #ddd;
      display:flex;
      flex-direction:column;
    }

    .search_box {
      padding:10px;
      border-bottom:1px solid #ddd;
    }
    .search_box input {width:220px; padding:5px;}
    .search_box button {padding:6px 10px; margin-left:5px;}

    #menu_wrap {
      flex:1;
      overflow-y:auto;
      padding:10px;
    }
    #placesList li {
      list-style:none;
      padding:10px;
      border-bottom:1px solid #eee;
      cursor:pointer;
    }
    #placesList li:hover {background:#f7f7f7;}

    /* ì˜¤ë¥¸ìª½ ì§€ë„ */
    #map {flex:1; position:relative;}

    /* ë°˜ê²½ ì»¨íŠ¸ë¡¤ */
    .radius_control {
      position:absolute; top:15px; left:15px;
      z-index:2; background:#fff;
      border-radius:5px; padding:10px;
      box-shadow:0 2px 4px rgba(0,0,0,0.2);
    }
  </style>
  <!-- âœ… ì¹´ì¹´ì˜¤ ì§€ë„ API (ë³¸ì¸ appkeyë¡œ êµì²´) -->
  <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=91e7ce40b4650e8a8c4f5fe947b382bb"></script>
</head>
<body>
<div class="container">
  <!-- ì™¼ìª½ ì‚¬ì´ë“œë°” -->
  <div class="sidebar">
    <div class="search_box">
      <input type="text" id="keyword" placeholder="ì¥ì†Œ ê²€ìƒ‰">
      <button onclick="searchPlaces()">ê²€ìƒ‰</button>
    </div>
    <div id="menu_wrap">
      <ul id="placesList"></ul>
    </div>
  </div>

  <!-- ì˜¤ë¥¸ìª½ ì§€ë„ -->
  <div id="map">
    <div class="radius_control">
      <label>ë°˜ê²½</label>
      <input type="range" id="radiusSlider" min="0" max="5000" step="100" value="1000">
      <span id="radiusValue">1km</span><br>
      í‘œì‹œëœ ì¥ì†Œ: <span id="markerCount">0</span>ê°œ
    </div>
  </div>
</div>

<script>
  // ğŸ“ ë‚´ê°€ ì§€ì •í•œ ìœ„ì¹˜ ë°°ì—´
  const locations = [
    { name: "ìŠ¤íƒ€ë²…ìŠ¤ ì™•ì‹­ë¦¬ì—­9ë²ˆì¶œêµ¬ì ", addr: "ì„œìš¸ ì„±ë™êµ¬ í–‰ë‹¹ë™", lat: 37.5612, lng: 127.0375 },
    { name: "ìŠ¤íƒ€ë²…ìŠ¤ ì—”í„°ì‹ìŠ¤ì ", addr: "ì„œìš¸ ì„±ë™êµ¬ ì„±ìˆ˜ë™", lat: 37.5618, lng: 127.0339 },
    { name: "ìŠ¤íƒ€ë²…ìŠ¤ í•œì–‘ëŒ€ì ", addr: "ì„œìš¸ ì„±ë™êµ¬ ì™•ì‹­ë¦¬ë¡œ", lat: 37.5553, lng: 127.0436 },
    { name: "ìŠ¤íƒ€ë²…ìŠ¤ ìƒì™•ì‹­ë¦¬ì—­ì ", addr: "ì„œìš¸ ì¤‘êµ¬ í•˜ì™•ì‹­ë¦¬", lat: 37.5645, lng: 127.0294 }
  ];

  let map, circle;
  let markers = [];
  const centerPosition = new kakao.maps.LatLng(37.5612, 127.0375);

  // âœ… ì§€ë„ ì´ˆê¸°í™”
  function initMap() {
    const container = document.getElementById('map');
    const options = { center: centerPosition, level: 5 };
    map = new kakao.maps.Map(container, options);

    // ë°˜ê²½ ì›
    circle = new kakao.maps.Circle({
      center: centerPosition,
      radius: 1000,
      strokeWeight: 2,
      strokeColor: '#007BFF',
      strokeOpacity: 0.8,
      fillColor: '#BEE6FF',
      fillOpacity: 0.3
    });
    circle.setMap(map);

    // ì´ˆê¸° ì¶œë ¥
    renderPlaces(locations);
  }

  // âœ… ê±°ë¦¬ ê³„ì‚° í•¨ìˆ˜
  function calculateDistance(pos1, pos2) {
    const lat1 = pos1.getLat(), lon1 = pos1.getLng();
    const lat2 = pos2.getLat(), lon2 = pos2.getLng();
    const R = 6371000;
    const toRad = d => d * Math.PI / 180;
    const dLat = toRad(lat2 - lat1);
    const dLon = toRad(lon2 - lon1);
    const a = Math.sin(dLat / 2) ** 2 +
              Math.cos(toRad(lat1)) * Math.cos(toRad(lat2)) *
              Math.sin(dLon / 2) ** 2;
    return R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
  }

  // âœ… ì¥ì†Œ ë¦¬ìŠ¤íŠ¸ + ë§ˆì»¤ í‘œì‹œ
  function renderPlaces(list) {
    // ë§ˆì»¤ ì´ˆê¸°í™”
    markers.forEach(m => m.setMap(null));
    markers = [];

    const listEl = document.getElementById('placesList');
    listEl.innerHTML = "";
    const radius = parseInt(document.getElementById('radiusSlider').value, 10);
    let visibleCount = 0;

    list.forEach(loc => {
      const pos = new kakao.maps.LatLng(loc.lat, loc.lng);
      const dist = calculateDistance(centerPosition, pos);

      if (dist <= radius) {
        // ë§ˆì»¤ ì¶”ê°€
        const marker = new kakao.maps.Marker({ position: pos, map: map, title: loc.name });
        markers.push(marker);

        // ë¦¬ìŠ¤íŠ¸ í•­ëª© ì¶”ê°€
        const el = document.createElement('li');
        el.innerHTML = `
          <div><b>${loc.name}</b></div>
          <div style="font-size:12px; color:#555;">${loc.addr}</div>
          <div style="font-size:12px; color:#007BFF;">ê±°ë¦¬: ${dist>=1000 ? (dist/1000).toFixed(1)+'km' : Math.round(dist)+'m'}</div>
        `;
        el.onclick = () => {
          map.setCenter(pos);
          map.setLevel(3);
        };
        listEl.appendChild(el);

        visibleCount++;
      }
    });

    document.getElementById('markerCount').innerText = visibleCount;
  }

  // âœ… ê²€ìƒ‰ ê¸°ëŠ¥ (ë‚´ ìœ„ì¹˜ ë°°ì—´ë§Œ ê²€ìƒ‰)
  function searchPlaces() {
    const keyword = document.getElementById('keyword').value.toLowerCase();
    const filtered = locations.filter(loc => loc.name.toLowerCase().includes(keyword));
    renderPlaces(filtered);
  }

  // âœ… ë°˜ê²½ ìŠ¬ë¼ì´ë” ì´ë²¤íŠ¸
  document.getElementById('radiusSlider').addEventListener('input', function() {
    const radius = parseInt(this.value, 10);
    circle.setRadius(radius);
    document.getElementById('radiusValue').innerText = radius >= 1000 ? (radius/1000)+'km' : radius+'m';
    searchPlaces(); // ë°˜ê²½ ë³€ê²½ ì‹œ í˜„ì¬ ê²€ìƒ‰ê²°ê³¼ ë°˜ì˜
  });

  window.onload = initMap;
</script>
</body>
</html>
